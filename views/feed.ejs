<%- include('partials/header') %>

<h2>Feed</h2>

<% if (currentUser) { %>
<form action="/posts" method="post" enctype="multipart/form-data" class="post-form">
  <textarea name="content" rows="3" placeholder="Share something..." required></textarea>
  <input type="file" name="image" accept="image/*">
  <button type="submit">Post</button>
</form>
<% } else { %>
<p><a href="/login">Login</a> to post</p>
<% } %>

<section class="posts">
  <% posts.forEach(post => { %>
  <article class="post">
    <header class="post-header">
      <img class="avatar" src="<%= post.avatar || '/public/img/default-avatar.svg' %>" alt="avatar">
      <div class="post-author">
        <a href="/u/<%= post.user_id %>"><strong><%= post.name %></strong></a>
        <div class="muted"><%= post.headline %></div>
      </div>
      <time class="muted"><%= new Date(post.created_at).toLocaleString() %></time>
    </header>
    <div class="post-content">
      <p><%= post.content %></p>
      <% if (post.image) { %>
        <img class="post-image" src="<%= post.image %>" alt="post image">
      <% } %>
    </div>
    <div class="post-actions">
      <form action="/posts/<%= post.id %>/like" method="post" style="display: inline;">
        <button type="submit" class="action-btn <%= post.user_liked ? 'liked' : '' %>">
          ‚ù§Ô∏è <%= post.like_count %>
        </button>
      </form>
      <span class="action-btn">üí¨ <%= post.comment_count %></span>
    </div>
    <div class="comments-section">
      <% if (currentUser) { %>
      <form action="/posts/<%= post.id %>/comment" method="post" class="comment-form">
        <input type="text" name="content" placeholder="Add a comment..." required>
        <button type="submit">Comment</button>
      </form>
      <% } %>
    </div>
  </article>
  <% }) %>
</section>

<%- include('partials/footer') %>
